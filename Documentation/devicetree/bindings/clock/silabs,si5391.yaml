# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/clock/skyworks,si5391.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Silicon Labs Si5391 Clock Generator

maintainers:
  - Linux Kernel Developer <linux-clk@vger.kernel.org>

description: |
  The Si5391 is a programmable I2C clock generator with up to 10 output
  clocks. The chip contains a PLL that generates a high-frequency VCO
  clock which is then divided down to produce the output clocks.

  The device can accept input from up to 4 sources: three differential
  input clocks (IN0, IN1, IN2) or a crystal oscillator (XTAL).

  Each output can be individually configured for format (LVDS, LVPECL,
  HCSL, LVCMOS), amplitude, and frequency through an R-divider.

  The driver supports runtime configuration of output frequencies and
  can be used in "as-is" mode where it reads the current configuration
  from a pre-programmed device.

properties:
  compatible:
    const: skyworks,si5391

  reg:
    maxItems: 1
    description: I2C device address, typically 0x74

  "#clock-cells":
    const: 1
    description: |
      The clock cell value specifies the output index (0-9).

  clocks:
    minItems: 1
    maxItems: 4
    description: |
      List of parent clock phandles, corresponding to the input clocks.
      Use a fixed-clock for the XTAL input.

  clock-names:
    minItems: 1
    maxItems: 4
    items:
      enum: ["xtal", "in0", "in1", "in2"]
    description: |
      Names of the input clocks. At least one input must be provided.

  vdd-supply:
    description: Regulator for core VDD supply

  vdda-supply:
    description: Regulator for analog VDDA supply

  vdds-supply:
    description: Regulator for VDDS supply

  vddoN-supply:
    description: |
      Regulator for output N VDDO supply (where N is 0-9).
      The driver selects the output VDD_SEL setting based on this voltage.
    pattern: "^vddo[0-9]$"

  skyworks,pll-m-num:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: |
      Numerator for PLL feedback divider. Must be set such that the
      PLL VCO frequency is in the range 13.5-14.256 GHz.

  skyworks,pll-m-den:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: |
      Denominator for PLL feedback divider. Together with pll-m-num,
      determines the PLL multiplication factor.

  skyworks,xaxb-ext-clk:
    type: boolean
    description: |
      When present, indicates that XA/XB pins are used in external
      reference clock mode rather than crystal oscillator mode.

  skyworks,iovdd-33:
    type: boolean
    description: |
      When present, indicates that I2C interface uses 3.3V logic
      levels rather than 1.8V.

  skyworks,reprogram:
    type: boolean
    description: |
      When present, the driver will always perform a soft reset and
      full initialization of the device. Use with caution as this
      will temporarily stop all output clocks.

  interrupts:
    maxItems: 1
    description: Interrupt line connected to INTRb pin

  "#address-cells":
    const: 1

  "#size-cells":
    const: 0

patternProperties:
  "^out@[0-9]$":
    type: object
    description: |
      Optional child node for configuring individual outputs.
      If not specified, the output configuration is left unchanged.

    properties:
      reg:
        minimum: 0
        maximum: 9
        description: Output index

      skyworks,format:
        $ref: /schemas/types.yaml#/definitions/uint32
        enum: [1, 2, 4]
        description: |
          Output format:
          1 = Differential (LVDS/LVPECL)
          2 = Low-power (HCSL)
          4 = LVCMOS

      skyworks,common-mode:
        $ref: /schemas/types.yaml#/definitions/uint32
        minimum: 0
        maximum: 15
        description: |
          Output common mode voltage setting.
          See Si5391 reference manual for specific values.

      skyworks,amplitude:
        $ref: /schemas/types.yaml#/definitions/uint32
        minimum: 0
        maximum: 15
        description: |
          Output amplitude setting.
          See Si5391 reference manual for specific values.

      skyworks,disable-high:
        type: boolean
        description: |
          When present, output is driven HIGH when disabled.
          Otherwise, output is driven LOW when disabled.

      always-on:
        type: boolean
        description: |
          When present, this output is always enabled and cannot
          be disabled at runtime.

    required:
      - reg

    additionalProperties: false

required:
  - compatible
  - reg
  - "#clock-cells"
  - clocks
  - clock-names

additionalProperties: false

examples:
  - |
    #include <dt-bindings/clock/si5391.h>

    /* 48MHz reference crystal */
    ref48: ref48M {
        compatible = "fixed-clock";
        #clock-cells = <0>;
        clock-frequency = <48000000>;
    };

    i2c {
        #address-cells = <1>;
        #size-cells = <0>;

        si5391: clock-generator@77 {
            compatible = "silabs,si5391";
            reg = <0x77>;
            #clock-cells = <1>;
            #address-cells = <1>;
            #size-cells = <0>;

            clocks = <&ref48>;
            clock-names = "xtal";

            skyworks,pll-m-num = <14000>;  /* PLL at 14.0 GHz */
            skyworks,pll-m-den = <48>;
            skyworks,iovdd-33;              /* 3.3V I2C interface */

            /* Configure OUT8 for 200MHz LVDS */
            out@8 {
                reg = <8>;
                skyworks,format = <1>;      /* LVDS */
                skyworks,common-mode = <3>;
                skyworks,amplitude = <3>;
                always-on;
            };

            /* Configure OUT9 for 100MHz LVDS */
            out@9 {
                reg = <9>;
                skyworks,format = <1>;      /* LVDS */
                skyworks,common-mode = <3>;
                skyworks,amplitude = <3>;
                always-on;
            };
        };
    };

    /* Example of a consumer device using OUT8 */
    some-device {
        clocks = <&si5391 8>;
        clock-names = "refclk";
        assigned-clocks = <&si5391 8>;
        assigned-clock-rates = <200000000>;
    };
...
