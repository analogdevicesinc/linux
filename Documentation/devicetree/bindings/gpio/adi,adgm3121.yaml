# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/gpio/adi,adgm3121.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: ADI ADGM3121/ADGM3144 MEMS RF Switch

maintainers:
  - Antoniu Miclaus <antoniu.miclaus@analog.com>

description: |
  The ADGM3121 is a 3mm x 3mm DPDT (Dual-Pole Dual-Throw) MEMS switch
  operating from DC to 23 GHz. The ADGM3144 is a 3mm x 3mm SP4T
  (Single-Pole Four-Throw) MEMS switch with the same characteristics.

  ADGM3121: RF1A/1B and RF2A/2B ports connected to RFCA/RFCB
  ADGM3144: RF1-4 ports connected to RFC

  Both devices support two control modes:
  - Parallel GPIO mode: Direct control via IN1-IN4 GPIO pins
  - SPI mode: Control via SPI interface with register access

  Key features:
  - DC to 23 GHz frequency range
  - Low insertion loss: -0.5 dB (typical) at 6 GHz
  - High isolation: -22 dB (typical) at 6 GHz
  - Fast switching time: 200 µs (typical)
  - High cycle count: 100 million cycles minimum at +85°C

allOf:
  - $ref: /schemas/spi/spi-peripheral-props.yaml#

properties:
  compatible:
    enum:
      - adi,adgm3121
      - adi,adgm3144

  reg:
    description: SPI chip select number (SPI mode only)
    maxItems: 1

  spi-max-frequency:
    description: Maximum SPI frequency (SPI mode only)
    maximum: 10000000

  gpio-controller: true

  "#gpio-cells":
    description: |
      Number of cells used to specify a GPIO. The meaning of the cells are:
        - First cell: GPIO number (0-3)
        - Second cell: GPIO flags (GPIO_ACTIVE_HIGH/GPIO_ACTIVE_LOW)
    const: 2

  ngpios:
    description: Number of GPIOs available
    const: 4

  pin-spi-gpios:
    description: |
      GPIO specifier for the PIN/SPI mode select pin.
      HIGH = SPI mode, LOW = Parallel GPIO mode
    maxItems: 1

  in1-gpios:
    description: GPIO specifier for IN1 control pin (Parallel mode only)
    maxItems: 1

  in2-gpios:
    description: GPIO specifier for IN2 control pin (Parallel mode only)
    maxItems: 1

  in3-gpios:
    description: GPIO specifier for IN3 control pin (Parallel mode only)
    maxItems: 1

  in4-gpios:
    description: GPIO specifier for IN4 control pin (Parallel mode only)
    maxItems: 1

required:
  - compatible
  - gpio-controller
  - "#gpio-cells"
  - ngpios
  - pin-spi-gpios

if:
  required:
    - reg
then:
  # SPI mode
  required:
    - spi-max-frequency
else:
  # Parallel GPIO mode
  required:
    - in1-gpios
    - in2-gpios
    - in3-gpios
    - in4-gpios

additionalProperties: false

examples:
  - |
    #include <dt-bindings/gpio/gpio.h>

    // SPI mode example - ADGM3121 DPDT switch
    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        switch@0 {
            compatible = "adi,adgm3121";
            reg = <0>;
            spi-max-frequency = <10000000>;
            gpio-controller;
            #gpio-cells = <2>;
            ngpios = <4>;
            pin-spi-gpios = <&gpio0 1 GPIO_ACTIVE_HIGH>;
        };
    };

  - |
    #include <dt-bindings/gpio/gpio.h>

    // SPI mode example - ADGM3144 SP4T switch
    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        switch@0 {
            compatible = "adi,adgm3144";
            reg = <0>;
            spi-max-frequency = <10000000>;
            gpio-controller;
            #gpio-cells = <2>;
            ngpios = <4>;
            pin-spi-gpios = <&gpio0 1 GPIO_ACTIVE_HIGH>;
        };
    };

  - |
    #include <dt-bindings/gpio/gpio.h>

    // Parallel GPIO mode example - ADGM3121
    switch {
        compatible = "adi,adgm3121";
        gpio-controller;
        #gpio-cells = <2>;
        ngpios = <4>;
        pin-spi-gpios = <&gpio0 1 GPIO_ACTIVE_LOW>;
        in1-gpios = <&gpio0 2 GPIO_ACTIVE_HIGH>;
        in2-gpios = <&gpio0 3 GPIO_ACTIVE_HIGH>;
        in3-gpios = <&gpio0 4 GPIO_ACTIVE_HIGH>;
        in4-gpios = <&gpio0 5 GPIO_ACTIVE_HIGH>;
    };