# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/hwmon/adi,ltc4284.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Analog Devices LTC4284 High Power Negative Voltage Hot Swap Controller

maintainers:
  - Carlos Jones Jr <carlosjr.jones@analog.com>

description: |
  Analog Devices LTC4284 High Power Negative Voltage Hot Swap Controller
  with Energy Monitor. The device is designed for high power negative
  voltage hot swap applications, primarily in -48V distributed power systems.

  https://www.analog.com/media/en/technical-documentation/data-sheets/ltc4284.pdf

properties:
  compatible:
    enum:
      - adi,ltc4284

  reg:
    maxItems: 1

  vdd-supply: true

  adi,rsense1-nano-ohms:
    description: Value of the first current sense resistor in nano-ohms.

  adi,rsense2-nano-ohms:
    description: Value of the second current sense resistor in nano-ohms.

  adi,vin-mode-microvolt:
    description: |
      Selects operating range for the Undervoltage, Overvoltage and ADC
      circuits. Should be set to the nominal input voltage magnitude.
      For negative voltage systems, specify the absolute value.
    enum: [3300000, 5000000, 12000000, 24000000, 48000000]
    default: 48000000

  adi,current-limit-sense-microvolt:
    description: |
      The current limit sense voltage of the chip is adjustable between
      15mV and 30mV. This effectively limits the current on the load.
      Values are in microvolts.
    minimum: 15000
    maximum: 30000
    default: 25000

  adi,operation-mode:
    description: |
      Configures the dual-gate operation mode of the LTC4284.
      single: Single driver mode (Mode 1) - uses only GATE1
      parallel: Parallel mode (Mode 2) - both gates driven together
      staged-high-stress: High stress staged start mode (Mode 3)
      staged-low-stress: Low stress staged start mode (Mode 4)
    $ref: /schemas/types.yaml#/definitions/string
    enum: [single, parallel, staged-high-stress, staged-low-stress]
    default: parallel

  adi,fet-bad-timeout-ms:
    description: |
      From the moment a FET bad condition is present, this property selects the
      wait time/timeout for a FET-bad fault to be signaled. Setting this to 0
      disables FET bad fault reporting.
    minimum: 0
    maximum: 255
    default: 255

  adi,overcurrent-retry:
    description: |
      If set, enables the chip to auto-retry after an overcurrent fault.
    type: boolean

  adi,overvoltage-retry-disable:
    description: |
      If set, disables the chip auto-retry after an overvoltage fault.
      Auto-retry is enabled by default.
    type: boolean

  adi,undervoltage-retry-disable:
    description: |
      If set, disables the chip auto-retry after an undervoltage fault.
      Auto-retry is enabled by default.
    type: boolean

  adi,inrush-control-mode:
    description: |
      Selects the inrush current control method during startup.
      dvdt: dV/dt controlled startup
      current-limit: Current limit controlled startup
    $ref: /schemas/types.yaml#/definitions/string
    enum: [dvdt, current-limit]
    default: current-limit

  adi,fault-log-enable:
    description: |
      If set, enables the FAULT_LOG and ADC_ALERT_LOG registers to be written
      to the EEPROM when a fault bit transitions high, making the fault
      information available after a power cycle.
    type: boolean

  adi,external-fault-enable:
    description: |
      If set, enables monitoring of external fault input for system-level
      fault detection.
    type: boolean

  adi,power-good-timeout-ms:
    description: |
      Timeout value for power good input watchdog timer. If power good input
      is not asserted within this time after startup, the device will shut down.
    minimum: 256
    maximum: 1024
    default: 512

required:
  - compatible
  - reg
  - adi,rsense1-nano-ohms

additionalProperties: false

examples:
  - |
    i2c {
        #address-cells = <1>;
        #size-cells = <0>;

        ltc4284@50 {
            compatible = "adi,ltc4284";
            reg = <0x50>;
            adi,rsense1-nano-ohms = <500000>;  /* 0.5 mOhm */
            adi,rsense2-nano-ohms = <330000>;  /* 0.33 mOhm */
            adi,vin-mode-microvolt = <48000000>;
            adi,operation-mode = "parallel";
            adi,current-limit-sense-microvolt = <25000>;
            adi,inrush-control-mode = "current-limit";
            adi,overcurrent-retry;
            adi,fault-log-enable;
        };
    };
...
