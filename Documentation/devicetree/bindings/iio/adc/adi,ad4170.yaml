# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/iio/adc/adi,ad4170.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Analog Devices AD4170 Analog to Digital Converter

maintainers:
  - Marcelo Schmitt <marcelo.schmitt@analog.com>

description: |
  Analog Devices AD4170 Analog to Digital Converter.
  Specifications can be found at:
    https://www.analog.com/media/en/technical-documentation/data-sheets/ad4170-4.pdf

$ref: /schemas/spi/spi-peripheral-props.yaml#

properties:
  compatible:
    enum:
      - adi,ad4170

  avss-supply:
    description:
      Referece voltage supply for AVDD. AVSS can be set below 0V to provide a
      bipolar power supply to AD4170-4. Must be −2.625V at minimum, 0V maximum.
      If not specified, this is assumed to be analog ground.

  avdd-supply:
    description:
      A supply of 4.75V to 5.25V relative to AVSS that powers the chip (AVDD).

  iovdd-supply:
    description: 1.7V to 5.25V reference supply to the serial interface (IOVDD).

  refin1p-supply:
    description: REFIN+ supply that can be used as reference for conversion.

  refin1n-supply:
    description: REFIN- supply that can be used as reference for conversion.

  refin2p-supply:
    description: REFIN2+ supply that can be used as reference for conversion.

  refin2n-supply:
    description: REFIN2- supply that can be used as reference for conversion.

  adi,gpio0-power-down-switch:
    type: boolean
    description:
      Describes whether GPIO0 is used as a switch to disconnect bridge circuits
      from AVSS. Pin defaults to GPIO if this property is not present.

  adi,gpio1-power-down-switch:
    type: boolean
    description:
      Describes whether GPIO1 is used as a switch to disconnect bridge circuits
      from AVSS. Pin defaults to GPIO if this property is not present.

  adi,vbias-pins:
    description: Analog inputs to apply a voltage bias of (AVDD − AVSS) / 2 to.
    $ref: /schemas/types.yaml#/definitions/uint32-array
    minItems: 1
    maxItems: 9
    items:
      minimum: 0
      maximum: 8

  adi,burnout-current-nanoamp:
    description: |
      Burnout current in nanoamps to be applied for this channel.
    enum: [0, 100, 2000, 10000]
    default: 0

  adi,chop-adc:
    description:
      Specifies the chopping/swapping functionality for a channel setup. Macros
      for adi,chop-adc values are available in dt-bindings/iio/adi,ad4170.h.
      When enabled, the analog inputs are continuously swapped and a conversion
      is generated for each phase. The analog input pins are connected in one
      direction, sampled, swapped, sampled again, and then the conversion
      results are averaged. The input swapp minimizes system offset and offset
      drif. This property also specifies wheter AC excitation using 2 or 4 GPIOs
      are going to be used.
    enum: [0, 1, 2, 3]
    default: 0


required:
  - compatible
  - reg
  - avdd-supply
  - iovdd-supply

patternProperties:
  "^channel@([0-9]|1[0-5])$":
    $ref: "adc.yaml"
    type: object
    description: |
      Represents the external channels which are connected to the ADC.

    properties:
      reg:
        description: |
          The channel number. The device can have up to 16 channels numbered
          from 0 to 15.
        items:
          minimum: 0
          maximum: 15

      adi,reference-select:
        description: |
          Select the reference source to use when converting on
          the specific channel. Valid values are:
          0: Differential reference voltage REFIN+ - REFIN−.
          1: Differential reference voltage REFIN2+ - REFIN2−.
          3: Analog supply voltage (AVDD) relative relative AVSS.
          4: Internal 2.5V referece (REFOUT) relative to AVSS.
          If this field is left empty, internal reference is selected.
        $ref: /schemas/types.yaml#/definitions/uint32
        enum: [0, 1, 3, 4]
        default: 4

      diff-channels: true

      bipolar: true

      adi,buffered-positive:
        description: Enable buffered mode for positive input.
        type: boolean

      adi,buffered-negative:
        description: Enable buffered mode for negative input.
        type: boolean

    required:
      - reg
      - diff-channels

    additionalProperties: false

unevaluatedProperties: false

examples:
  - |
    #include <dt-bindings/interrupt-controller/irq.h>
    #include <dt-bindings/iio/adc/adi,ad4170.h>
    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        adc@0 {
            compatible = "adi,ad4170";
            reg = <0>;
            avdd-supply = <&avdd>;
            #address-cells = <1>;
            #size-cells = <0>;
            dmas = <&axi_dmac_0 0>;
            dma-names = "rx";
            spi-max-frequency = <20000000>;
            interrupt-parent = <&gpio_in>;
            interrupts = <0 IRQ_TYPE_EDGE_FALLING>;
            interrupt-names = "adc_rdy";
            adi,dig-aux1-function = "rdy";
            adi,vbias-pins = <5 6>;

            channel@0 {
                reg = <0>;
                adi,reference-select = <2>;
                /* AIN8, DGND  */
                diff-channels = <8 24>;
            };
            channel@1 {
                reg = <1>;
                adi,reference-select = <2>;
                /* TEMP_SENSOR+, TEMP_SENSOR- */
                diff-channels = <17 17>;
            };
        };
    };
...

