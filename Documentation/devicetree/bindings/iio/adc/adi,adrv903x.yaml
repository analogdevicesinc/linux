# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
# Copyright 2024 Analog Devices Inc.
%YAML 1.2
---
$id: http://devicetree.org/schemas/iio/adc/adi,adrv903x.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Analog Devices ADRV9032/ADRV9032R RF Transceiver

maintainers:
  - Stefan Popa <stefan.popa@analog.com>

description: |
  The ADRV9032R is a highly integrated, RF agile transceiver offering two
  transmitters, two observation receivers for monitoring transmitter channels,
  two receivers, integrated local oscillator (LO) and clock synthesizers, and
  digital signal processing functions to provide a complete transceiver solution.

  The device provides high radio performance and low power consumption demanded
  by cellular infrastructure applications, software-defined radios, portable
  instruments, and military communications.

  The receiver and transmitter signal paths use a zero-IF (ZIF) architecture
  that provides wide bandwidth with dynamic range suitable for non-contiguous
  multicarrier applications.

  https://www.analog.com/en/products/adrv9032r.html
  https://analogdevicesinc.github.io/documentation/solutions/reference-designs/eval-adrv9032/index.html

properties:
  compatible:
    enum:
      - adi,adrv9032
      - adi,adrv9032r

  reg:
    maxItems: 1

  spi-max-frequency:
    maximum: 25000000

  interrupts:
    maxItems: 1
    description:
      GPIO interrupt pin (typically GPINT1)

  clocks:
    description:
      Device clock reference input
    maxItems: 1

  clock-names:
    const: dev_clk

  clock-output-names:
    description:
      Names for the clock outputs generated by the device
    items:
      - const: rx_sampl_clk
      - const: tx_sampl_clk
      - const: obs_sampl_clk

  '#clock-cells':
    const: 1

  jesd204-device:
    description:
      Indicates this device is part of JESD204 topology
    type: boolean

  '#jesd204-cells':
    const: 2

  jesd204-top-device:
    description:
      Indicates if this is the top device in JESD204 topology
    $ref: /schemas/types.yaml#/definitions/uint32
    enum: [0, 1]

  jesd204-inputs:
    description:
      JESD204 input connections from framers/deframers
    $ref: /schemas/types.yaml#/definitions/phandle-array

  adi,device-config-name:
    description:
      Firmware filename for device configuration profile binary
    $ref: /schemas/types.yaml#/definitions/string

  adi,arm-firmware-name:
    description:
      Firmware filename for ARM processor firmware
    $ref: /schemas/types.yaml#/definitions/string

  adi,stream-firmware-name:
    description:
      Firmware filename for stream processor image
    $ref: /schemas/types.yaml#/definitions/string

  adi,rx-gaintable-names:
    description:
      Filename for receiver gain table (CSV format)
    $ref: /schemas/types.yaml#/definitions/string

  adi,rx-gaintable-channel-masks:
    description:
      Bitmask indicating which RX channels use the gain table.
      Bit 0 = RX0, Bit 1 = RX1, etc.
    $ref: /schemas/types.yaml#/definitions/uint32

required:
  - compatible
  - reg
  - clocks
  - clock-names
  - adi,device-config-name
  - adi,arm-firmware-name
  - adi,stream-firmware-name

patternProperties:
  "^jesd204-":
    true

additionalProperties: false

examples:
  - |
    #include <dt-bindings/interrupt-controller/irq.h>

    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        transceiver@0 {
            compatible = "adi,adrv9032r";
            reg = <0>;
            spi-max-frequency = <25000000>;

            interrupt-parent = <&gpio>;
            interrupts = <134 IRQ_TYPE_EDGE_RISING>;

            clocks = <&clk_generator 1>;
            clock-names = "dev_clk";

            clock-output-names = "rx_sampl_clk", "tx_sampl_clk", "obs_sampl_clk";
            #clock-cells = <1>;

            jesd204-device;
            #jesd204-cells = <2>;
            jesd204-top-device = <0>;
            jesd204-link-ids = <0 1 2>;

            jesd204-inputs = <&axi_rx_jesd 0 1>,
                           <&axi_rx_os_jesd 0 2>,
                           <&axi_tx_core 0 0>;

            adi,device-config-name = "ADRV9030_DeviceProfileTest_M4.bin";
            adi,arm-firmware-name = "ADRV9030_FW.bin";
            adi,stream-firmware-name = "ADRV9030_stream_image.bin";
            adi,rx-gaintable-names = "ADRV9030_RxGainTable.csv";
            adi,rx-gaintable-channel-masks = <0xFF>;
        };
    };
