# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/iio/adc/adi,adrv9040.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Analog Devices ADRV904X RF Transceiver

maintainers:
  - Stefan Popa <stefan.popa@analog.com>
  - George Mois <george.mois@analog.com>

description: |
  The ADRV904X is a highly integrated RF transceiver supporting 8 transmitter
  and 8 receiver channels with observation receivers, designed for cellular
  infrastructure applications. It integrates digital front-end (DFE) processing,
  JESD204B/C interface, and advanced calibration features.

properties:
  compatible:
    enum:
      - adi,adrv9040

  reg:
    maxItems: 1

  spi-max-frequency:
    maximum: 25000000

  clocks:
    items:
      - description: Device clock input

  clock-names:
    items:
      - const: dev_clk

  clock-output-names:
    minItems: 1
    maxItems: 3
    description: |
      Names for the output clocks. Typically includes rx_sampl_clk,
      obs_sampl_clk, and tx_sampl_clk.

  '#clock-cells':
    const: 1

  reset-gpios:
    maxItems: 1
    description: GPIO for device reset control

  interrupts:
    maxItems: 1
    description: Interrupt from the device for events like JESD errors

  adi,device-config-name:
    $ref: /schemas/types.yaml#/definitions/string
    description: |
      Filename of the device profile binary configuration file. This file
      contains the device initialization configuration.

  adi,arm-firmware-name:
    $ref: /schemas/types.yaml#/definitions/string
    description: Filename of the ARM firmware binary for the main CPU.

  adi,arm-dfe-firmware-name:
    $ref: /schemas/types.yaml#/definitions/string
    description: Filename of the ARM firmware binary for the DFE (Digital Front End) CPU.

  adi,stream-firmware-name:
    $ref: /schemas/types.yaml#/definitions/string
    description: Filename of the stream processor firmware binary.

  adi,rx-gaintable-names:
    $ref: /schemas/types.yaml#/definitions/string-array
    description: |
      Array of filenames for RX gain table CSV files. Each entry corresponds
      to a gain table configuration.

  adi,rx-gaintable-channel-masks:
    $ref: /schemas/types.yaml#/definitions/uint32-array
    description: |
      Array of channel masks indicating which RX channels use the corresponding
      gain table from adi,rx-gaintable-names. Each mask is a bit field where
      bit N represents RX channel N.

  adi,tx-attntable-names:
    $ref: /schemas/types.yaml#/definitions/string-array
    description: |
      Array of filenames for TX attenuation table CSV files. Each entry
      corresponds to an attenuation table configuration.

  adi,tx-attntable-channel-masks:
    $ref: /schemas/types.yaml#/definitions/uint32-array
    description: |
      Array of channel masks indicating which TX channels use the corresponding
      attenuation table from adi,tx-attntable-names. Each mask is a bit field
      where bit N represents TX channel N.

  jesd204-device:
    type: boolean
    description: Indicates this device is a JESD204 device.

  '#jesd204-cells':
    const: 2

  jesd204-top-device:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: |
      Indicates if this is the top device in the JESD204 topology.
      Set to 0 for the top device.

  jesd204-link-ids:
    minItems: 1
    maxItems: 5
    description: |
      Array of JESD204 link IDs used by this device. Typically includes
      deframer and framer link identifiers.

  jesd204-inputs:
    $ref: /schemas/types.yaml#/definitions/phandle-array
    description: |
      Phandle references to JESD204 input devices with their link IDs.
      Format: <&phandle port_id link_id>

required:
  - compatible
  - reg
  - clocks
  - clock-names
  - adi,device-config-name
  - adi,arm-firmware-name
  - adi,arm-dfe-firmware-name
  - adi,stream-firmware-name

additionalProperties: false

examples:
  - |
    #include <dt-bindings/interrupt-controller/irq.h>
    #include <dt-bindings/iio/adc/adi,adrv904x.h>
    #include <dt-bindings/gpio/gpio.h>

    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        adrv904x@0 {
            compatible = "adi,adrv9040";
            reg = <0>;
            spi-max-frequency = <25000000>;

            interrupt-parent = <&gpio>;
            interrupts = <134 IRQ_TYPE_EDGE_RISING>;

            clocks = <&clk_ad9528 1>;
            clock-names = "dev_clk";

            clock-output-names = "rx_sampl_clk", "tx_sampl_clk", "obs_sampl_clk";
            #clock-cells = <1>;

            reset-gpios = <&gpio 134 GPIO_ACTIVE_LOW>;

            adi,device-config-name = "DeviceProfileTest.bin";
            adi,arm-firmware-name = "ADRV9040_FW.bin";
            adi,arm-dfe-firmware-name = "ADRV9040_DFE_CALS_FW.bin";
            adi,stream-firmware-name = "stream_image.bin";
            adi,rx-gaintable-names = "ADRV9040_RxGainTable.csv";
            adi,rx-gaintable-channel-masks = <0xFF>;

            jesd204-device;
            #jesd204-cells = <2>;
            jesd204-top-device = <0>;
            jesd204-link-ids = <DEFRAMER0_LINK_TX FRAMER0_LINK_RX>;
        };
    };
...
