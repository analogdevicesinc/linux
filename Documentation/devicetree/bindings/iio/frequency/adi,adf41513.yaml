# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/iio/frequency/adi,adf41513.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Analog Devices ADF41513 PLL Frequency Synthesizer

maintainers:
  - Rodrigo Alencar <rodrigo.alencar@analog.com>
  - Dragos Bogdan <dragos.bogdan@analog.com>

description: |
  The ADF41513 is an ultralow noise frequency synthesizer that can be used to
  implement local oscillators (LOs) as high as 26.5 GHz in the upconversion and
  downconversion sections of wireless receivers and transmitters.

  https://www.analog.com/en/products/adf41513.html

properties:
  compatible:
    enum:
      - adi,adf41510
      - adi,adf41513

  reg:
    maxItems: 1

  spi-max-frequency:
    maximum: 25000000

  clocks:
    maxItems: 1
    description: Clock that provides the reference input frequency.

  clock-names:
    const: refin

  '#clock-cells':
    const: 0

  clock-output-names:
    maxItems: 1

  adi,power-up-frequency:
    $ref: /schemas/types.yaml#/definitions/uint64
    description:
      If set, the PLL tunes to this frequency (in Hz) on driver probe.
      Range is 1 GHz to 26.5 GHz for ADF41513, and 1 GHz to 10 GHz for ADF41510.

  adi,reference-div-factor:
    $ref: /schemas/types.yaml#/definitions/uint32
    minimum: 1
    maximum: 32
    description:
      Reference division factor (R Counter). If not specified, the driver
      will calculate the optimal value automatically.

  adi,reference-doubler-enable:
    $ref: /schemas/types.yaml#/definitions/flag
    description:
      Enables the reference doubler. The maximum reference frequency when
      the doubler is enabled is 225 MHz.

  adi,reference-div2-enable:
    $ref: /schemas/types.yaml#/definitions/flag
    description:
      Enables the reference divide-by-2 function. This provides a 50%
      duty cycle signal to the PFD.

  adi,charge-pump-current:
    $ref: /schemas/types.yaml#/definitions/uint32
    minimum: 450
    maximum: 7200
    description:
      Charge pump current in microamps. The value will be rounded to the
      nearest supported value. Default is 2400 ï¿½A.

  adi,muxout-select:
    $ref: /schemas/types.yaml#/definitions/uint32
    minimum: 0
    maximum: 10
    description: |
      Multiplexer output selection. Valid values are:
      0: Tristate (default)
      1: Digital lock detect
      2: Charge pump up
      3: Charge pump down
      4: RDIV2
      5: N divider output
      6: VCO test
      7: Reserved
      8: High
      9: VCO calibration R band
      10: VCO calibration N band

  adi,phase-detector-polarity-positive:
    $ref: /schemas/types.yaml#/definitions/flag
    description:
      Set phase detector polarity to positive. Default is negative.
      Use positive polarity with non-inverting loop filter and VCO with
      positive tuning slope, or with inverting loop filter and VCO with
      negative tuning slope.

  adi,lock-detect-precision:
    $ref: /schemas/types.yaml#/definitions/uint32
    minimum: 0
    maximum: 3
    description:
      Lock detector precision setting. Higher values provide more precise
      lock detection but may increase lock time.

  adi,lock-detect-count:
    $ref: /schemas/types.yaml#/definitions/uint32
    minimum: 2
    maximum: 8192
    description:
      Number of consecutive phase detector cycles that must be within the
      lock detector window before lock is declared. Default is based on
      the lock detector precision setting.

  adi,target-resolution-hz:
    $ref: /schemas/types.yaml#/definitions/uint64
    description:
      Target frequency resolution in Hz for the algorithm to achieve.
      This influences the choice between fixed and variable modulus modes.
      Default is 1 Hz.

required:
  - compatible
  - reg
  - clocks

allOf:
  - $ref: /schemas/spi/spi-peripheral-props.yaml#

unevaluatedProperties: false

examples:
  - |
    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        pll@0 {
            compatible = "adi,adf41513";
            reg = <0>;
            spi-max-frequency = <10000000>;
            clocks = <&ref_clk>;
            clock-names = "refin";
            #clock-cells = <0>;

            adi,power-up-frequency = /bits/ 64 <12000000000>;
            adi,charge-pump-current = <2400>;
            adi,phase-detector-polarity-positive;
            adi,mute-till-lock-enable;
        };
    };
  - |
    spi {
        #address-cells = <1>;
        #size-cells = <0>;

        /* Example with algorithm optimization enabled */
        pll_optimized@0 {
            compatible = "adi,adf41513";
            reg = <0>;
            spi-max-frequency = <10000000>;
            clocks = <&ref_clk>;
            clock-names = "refin";
            #clock-cells = <0>;

            adi,power-up-frequency = /bits/ 64 <15500000000>;
            adi,auto-prescaler-enable;
            adi,optimize-pfd-enable;
            adi,target-resolution-hz = /bits/ 64 <1>;
            adi,phase-detector-polarity-positive;
        };
    };
...