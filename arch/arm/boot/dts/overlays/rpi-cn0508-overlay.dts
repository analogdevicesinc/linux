// SPDX-License-Identifier: GPL-2.0
/dts-v1/;
/plugin/;

/ {
	compatible = "brcm,bcm2835", "brcm,bcm2708", "brcm,bcm2709";

	__overrides__ {
		cs0_pin  = <&spi0_cs_pins>, "brcm,pins:0",
			   <&spi0>, "cs-gpios:4";
		cs1_pin  = <&spi0_cs_pins>, "brcm,pins:4",
			   <&spi0>, "cs-gpios:16";
		cs2_pin	=  <&spi0_cs_pins>, "brcm,pins:8",
			   <&spi0>, "cs-gpios:28";
		cs3_pin	=  <&spi0_cs_pins>, "brcm,pins:12",
			   <&spi0>, "cs-gpios:40";

		speed = <&pitft>, "spi-max-frequency:0";
		rotate = <&pitft>, "rotate:0";
		fps = <&pitft>, "fps:0";
		debug = <&pitft>, "debug:0";
	};
};

&spi0_cs_pins {
	brcm,pins = <22 27 8 7>;
	brcm,function = <1>; /* output */
};

&spi0 {
	cs-gpios = <&gpio 22 1>, <&gpio 27 1>,
		<&gpio 8 1>, <&gpio 7 1>;
	status = "okay";
};

&{/} {
	vref: fixedregulator@0 {
		compatible = "regulator-fixed";
		regulator-name = "fixed-supply";
		regulator-min-microvolt = <2500000>;
		regulator-max-microvolt = <2500000>;
		regulator-boot-on;
	};
};

&{/} {
	clocks {
		ad7124_mclk: clock@0 {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = <614400>;
		};
	};
};

&spi0 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";

	ad5686r@0 {
		compatible = "adi,ad5683r";
		reg = <0>;
		spi-max-frequency = <1000000>;
		spi-cpha;
		vcc-supply = <&vref>;
	};
};

&spi0 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";

	ad7124@1 {
		compatible = "adi,ad7124-4";
		reg = <1>;
		spi-max-frequency = <5000000>;
		interrupts = <23 2>;
		interrupt-parent = <&gpio>;
		refin1-supply = <&vref>;
		clocks = <&ad7124_mclk>;
		clock-names = "mclk";

		#address-cells = <1>;
		#size-cells = <0>;

		channel@0 {
			reg = <0>;
			diff-channels = <0 19>;
			adi,reference-select = <0>;
		};

		channel@1 {
			reg = <1>;
			diff-channels = <1 19>;
			adi,reference-select = <0>;
		};

		channel@2 {
			reg = <2>;
			diff-channels = <2 19>;
			adi,reference-select = <0>;
		};

		channel@3 {
			reg = <3>;
			diff-channels = <3 19>;
			adi,reference-select = <0>;
		};

		channel@4 {
			reg = <4>;
			diff-channels = <4 19>;
			adi,reference-select = <0>;
		};

		channel@5 {
			reg = <5>;
			diff-channels = <5 19>;
			adi,reference-select = <0>;
		};

		channel@6 {
			reg = <6>;
			diff-channels = <6 19>;
			adi,reference-select = <0>;
		};

		channel@7 {
			reg = <7>;
			diff-channels = <7 19>;
			adi,reference-select = <0>;
		};
	};
};

&spidev0 {
	status = "disabled";
};

&spidev1 {
	status = "disabled";
};

&gpio {
	pitft_pins: pitft_pins {
		brcm,pins = <24 25>;
		brcm,function = <0 1>; /* in out */
		brcm,pull = <2 0>; /* pullup none */
	};
};

&spi0 {
	/* needed to avoid dtc warning */
	#address-cells = <1>;
	#size-cells = <0>;

	pitft: pitft@2 {
		compatible = "ilitek,ili9340";
		reg = <2>;
		pinctrl-names = "default";
		pinctrl-0 = <&pitft_pins>;

		spi-max-frequency = <32000000>;
		rotate = <90>;
		fps = <25>;
		bgr;
		buswidth = <8>;
		dc-gpios = <&gpio 25 0>;
		debug = <0>;
	};

	pitft_ts@3 {
		compatible = "st,stmpe610";
		reg = <3>;

		spi-max-frequency = <500000>;
		irq-gpio = <&gpio 24 0x2>; /* IRQF_TRIGGER_FALLING */
		interrupts = <24 2>; /* high-to-low edge triggered */
		interrupt-parent = <&gpio>;
		interrupt-controller;

		stmpe_touchscreen {
			compatible = "st,stmpe-ts";
			st,sample-time = <4>;
			st,mod-12b = <1>;
			st,ref-sel = <0>;
			st,adc-freq = <2>;
			st,ave-ctrl = <3>;
			st,touch-det-delay = <4>;
			st,settling = <2>;
			st,fraction-z = <7>;
			st,i-drive = <0>;
		};

		stmpe_gpio: stmpe_gpio {
			#gpio-cells = <2>;
			compatible = "st,stmpe-gpio";
			/*
			 * only GPIO2 is wired/available
			 * and it is wired to the backlight
			 */
			st,norequest-mask = <0x7b>;
		};
	};
};

&{/soc} {
	backlight {
		compatible = "gpio-backlight";
		gpios = <&stmpe_gpio 2 0>;
		default-on;
	};
};
