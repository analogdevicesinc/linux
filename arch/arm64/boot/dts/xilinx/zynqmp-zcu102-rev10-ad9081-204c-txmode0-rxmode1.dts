// SPDX-License-Identifier: GPL-2.0
/*
 * Analog Devices AD9081-FMC-EBZ
 * https://wiki.analog.com/resources/eval/user-guides/quadmxfe/quick-start
 * https://wiki.analog.com/resources/tools-software/linux-drivers/iio-mxfe/ad9081
 *
 * hdl_project: <ad9081_fmca_ebz/zcu102>
 * board_revision: <>
 *
 * Copyright (C) 2021 Analog Devices Inc.
 */

// 204C use case with low lane rate, 6.6 Gbps using REFCLK 100mhz
//     * 4Txs / 4Rxs per MxFE
//     * DAC_CLK = 6.4 GSPS
//     * ADC_CLK = 3.2 GSPS
//     * Tx I/Q Rate: 3200 MSPS (Interpolation of 1x2)
//     * Rx I/Q Rate: 3200 MSPS (Decimation of 1x1)
//     * DAC JESD204B: Mode 0, L=1, M=8, N=N'=16
//     * ADC JESD204B: Mode 1, L=1, M=8, N=N'=16
//     * DAC-Side JESD204C Lane Rate: 6.6Gbps
//     * ADC-Side JESD204C Lane Rate: 6.6Gbps

// HDL Synthesis Parameters:
// JESD_MODE=64B66B
// RX_RATE=6.6
// RX_JESD_M=1
// RX_JESD_L=8
// RX_JESD_S=4
// RX_JESD_NP=16
// TX_RATE=6.6
// TX_JESD_M=1
// TX_JESD_L=8
// TX_JESD_S=4
// TX_JESD_NP=16

#include <dt-bindings/iio/adc/adi,ad9081.h>
#include "zynqmp-zcu102-rev10-ad9081-default.dtsi"

&axi_ad9081_rx_jesd {
	clocks = <&zynqmp_clk 71>, <&si570_refclk>, <&si570_refclk>, <&axi_ad9081_adxcvr_rx 0>;
	clock-names = "s_axi_aclk", "device_clk", "link_clk", "lane_clk";
};

&axi_ad9081_tx_jesd {
	clocks = <&zynqmp_clk 71>, <&si570_refclk>, <&si570_refclk>, <&axi_ad9081_adxcvr_tx 0>;
	clock-names = "s_axi_aclk", "device_clk", "link_clk", "lane_clk";
};

// &fmc_spi {

// 	trx0_ad9081: ad9081@0 {
// 		#address-cells = <1>;
// 		#size-cells = <0>;
// 		compatible = "adi,ad9081";
// 		reg = <0>;
// 		spi-max-frequency = <5000000>;

// 		/* Clocks */
// 		clocks = <&clk_sma>;
// 		clock-names = "dev_clk";

// 		clock-output-names = "rx_sampl_clk", "tx_sampl_clk";
// 		#clock-cells = <1>;

// 		// jesd204-device;
// 		// #jesd204-cells = <2>;
// 		// jesd204-top-device = <0>; /* This is the TOP device */
// 		// jesd204-link-ids = <FRAMER_LINK0_RX DEFRAMER_LINK0_TX>;
// 		jesd204-ignore-errors;

// 		// jesd204-inputs =
// 		// 	<&axi_ad9081_core_rx 0 FRAMER_LINK0_RX>,
// 		// 	<&axi_ad9081_core_tx 0 DEFRAMER_LINK0_TX>;

// 		adi,tx-dacs {
// 			#size-cells = <0>;
// 			#address-cells = <1>;

// 			adi,dac-frequency-hz = /bits/ 64 <6400000000>;

// 			adi,main-data-paths {
// 				#address-cells = <1>;
// 				#size-cells = <0>;

// 				adi,interpolation = <1>;

// 				ad9081_dac0: dac@0 {
// 					reg = <0>;
// 					adi,crossbar-select = <&ad9081_tx_fddc_chan0>;
// 					adi,nco-frequency-shift-hz = /bits/ 64 <1000000000>; /* 1000 MHz */
// 				};
// 			};

// 			adi,channelizer-paths {
// 				#address-cells = <1>;
// 				#size-cells = <0>;
// 				adi,interpolation = <2>;

// 				ad9081_tx_fddc_chan0: channel@0 {
// 					reg = <0>;
// 					adi,gain = <2048>; /* 2048 * 10^(gain_dB/20) */
// 					adi,nco-frequency-shift-hz =  /bits/ 64 <0>;

// 				};
// 			};

// 			adi,jesd-links {
// 				#size-cells = <0>;
// 				#address-cells = <1>;

// 				ad9081_tx_jesd_l0: link@0 {
// 					#address-cells = <1>;
// 					#size-cells = <0>;
// 					reg = <0>;

// 					adi,logical-lane-mapping = /bits/ 8 <0 2 7 6 1 5 4 3>;

// 					adi,link-mode = <0>;			/* JESD Quick Configuration Mode */
// 					adi,subclass = <1>;			/* JESD SUBCLASS 0,1,2 */
// 					adi,version = <2>;			/* JESD VERSION 0=204A,1=204B,2=204C */
// 					adi,dual-link = <0>;			/* JESD Dual Link Mode */

// 					adi,converters-per-device = <1>;	/* JESD M */
// 					adi,octets-per-frame = <1>;		/* JESD F */

// 					adi,frames-per-multiframe = <256>;	/* JESD K */
// 					adi,converter-resolution = <16>;	/* JESD N */
// 					adi,bits-per-sample = <16>;		/* JESD NP' */
// 					adi,control-bits-per-sample = <0>;	/* JESD CS */
// 					adi,lanes-per-device = <8>;		/* JESD L */
// 					adi,samples-per-converter-per-frame = <4>; /* JESD S */
// 					adi,high-density = <1>;			/* JESD HD */

// 					adi,tpl-phase-adjust = <0x3>;
// 				};
// 			};
// 		};

// 		adi,rx-adcs {
// 			#size-cells = <0>;
// 			#address-cells = <1>;

// 			adi,adc-frequency-hz = /bits/ 64 <3200000000>;

// 			adi,main-data-paths {
// 				#address-cells = <1>;
// 				#size-cells = <0>;


// 				ad9081_adc0: adc@0 {
// 					reg = <0>;
// 					adi,decimation = <1>;
// 					adi,nco-frequency-shift-hz = /bits/ 64 <1000000000>; /* 1000 MHz */
// 					adi,nco-mixer-mode = <AD9081_ADC_NCO_VIF>;
// 					adi,digital-gain-6db-enable;
// 					//adi,crossbar-select = <&ad9081_rx_fddc_chan0>, <&ad9081_rx_fddc_chan2>; /* Static for now */
// 				};
// 			};

// 			adi,channelizer-paths {
// 				#address-cells = <1>;
// 				#size-cells = <0>;


// 				ad9081_rx_fddc_chan0: channel@0 {
// 					reg = <0>;
// 					adi,decimation = <1>;
// 					adi,gain = <2048>; /* 2048 * 10^(gain_dB/20) */
// 					adi,nco-frequency-shift-hz =  /bits/ 64 <0>;
// 					adi,digital-gain-6db-enable;

// 				};
// 			};

// 			adi,jesd-links {
// 				#size-cells = <0>;
// 				#address-cells = <1>;

// 				ad9081_rx_jesd_l0: link@0 {
// 					reg = <0>;
// 					adi,converter-select =
// 						<&ad9081_rx_fddc_chan0 FDDC_I>;

// 					adi,logical-lane-mapping = /bits/ 8 <2 0 7 6 5 4 3 1>;

// 					adi,link-mode = <1>;			/* JESD Quick Configuration Mode */
// 					adi,subclass = <1>;			/* JESD SUBCLASS 0,1,2 */
// 					adi,version = <2>;			/* JESD VERSION 0=204A,1=204B,2=204C */
// 					adi,dual-link = <0>;			/* JESD Dual Link Mode */

// 					adi,converters-per-device = <1>;	/* JESD M */
// 					adi,octets-per-frame = <1>;		/* JESD F */

// 					adi,frames-per-multiframe = <256>;	/* JESD K */
// 					adi,converter-resolution = <16>;	/* JESD N */
// 					adi,bits-per-sample = <16>;		/* JESD NP' */
// 					adi,control-bits-per-sample = <0>;	/* JESD CS */
// 					adi,lanes-per-device = <8>;		/* JESD L */
// 					adi,samples-per-converter-per-frame = <4>; /* JESD S */
// 					adi,high-density = <1>;			/* JESD HD */
// 				};
// 			};
// 		};
// 	};
// };

&axi_ad9081_core_tx {
	single-shot-output-gpios = <&gpio 139 0>;
	single-shot-output-gpios = <&gpio 133 0>;
};

//&i2c1 {
//	i2c-mux@75 {
//		i2c@0 { /* HPC0 - FMC+ Crossover Cable */
//			/* Si5391A Clock Generator on FMC+ crossover ribbon cable */
//			si5391a: clock-generator@68 {
//				compatible = "skyworks,si5391a";
//				reg = <0x68>;  /* I2C address */
//
//				#clock-cells = <1>;
//				clock-output-names = "si5391a-out8-200mhz", "si5391a-out9-100mhz";
//
//				/* Optional reset GPIO - uncomment if RST_N is connected to GPIO */
//				/* reset-gpios = <&gpio <pin_number> GPIO_ACTIVE_HIGH>; */
//			};
//		};
//	};
//};
