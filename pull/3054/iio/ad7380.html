<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="ADC driver for Analog Devices Inc. AD7380 and similar devices. The module name is ad7380." name="description" />

    <title>AD7380 driver &#8212; Linux Drivers  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../_static/app.min.css?v=31a9e0ba" />
    <script async="async" src="../_static/app.umd.js?v=3a4867e9"></script>
    <link rel="icon" href="../_static/icon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AD7625 driver" href="ad7625.html" />
    <link rel="prev" title="AD7191 driver" href="ad7191.html" />
   
  
  
  <meta name="repository" content="linux">
  <meta name="version" content="">
  
    <meta name="page_source_suffix" content=".rst">
  
  
  


<style>
  body {
    
  }

  body.dark {
    
  }

  @media (prefers-color-scheme: dark) {
    body:not(.light) {
      
    }
  }
</style>
  </head>
  
    <body>
  
  <input type="checkbox" id="input-show-toc">
  <input type="checkbox" id="input-show-localtoc">
  <input type="checkbox" id="input-show-repotoc">

  
  <div class="search-area">
    <form action="" method="get">
      <input type="text" name="q" aria-labelledby="search-documentation" value="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="search" placeholder="Search"/>
      <button class="icon"></button>
    </form>
  </div>
  

  <header>
    <div id="left">
      <label id="show-sidebar" class="icon" for="input-show-toc" title="Show/hide index"></label>
    </div>
    <div id="right">
      <span>
        <a id="logo-org" href="https://analog.com" aria-label="Analog Devices Inc. landing page"></a>
        <div class="vertical-divider"></div>
        
        <label id="show-repotoc" for="input-show-repotoc" title="Show/hide docs" tabindex="0">Docs</label>
        
        <a id="logo" href="../index.html">
          <div>Linux</div>
        </a>
      </span>
      <span class="reverse">
        <label id="show-localtoc" class="icon" for="input-show-localtoc" title="Show/hide contents"></label>
      </span>
    </div>
  </header>


  <div class="repotoc-tree overlay">
    <root>
  <a href="../index.html" class="current">Linux</a>
</root>

  </div>
    <div class="localtoc">
      <div class="tocwrapper">
        <div class="header localtoc-header">
          <a id="scroll-up" href="#top-anchor" title="Back to top"></a>
        </div>
        <nav>
          <ul>
<li><a class="reference internal" href="#">AD7380 driver</a><ul>
<li><a class="reference internal" href="#supported-devices">Supported devices</a></li>
<li><a class="reference internal" href="#supported-features">Supported features</a><ul>
<li><a class="reference internal" href="#spi-wiring-modes">SPI wiring modes</a></li>
<li><a class="reference internal" href="#reference-voltage">Reference voltage</a><ul>
<li><a class="reference internal" href="#id1">ad7380-4</a></li>
<li><a class="reference internal" href="#id2">ad7389-4</a></li>
<li><a class="reference internal" href="#adaq-devices">ADAQ devices</a></li>
<li><a class="reference internal" href="#all-other-devices-from-ad738x-family">All other devices from ad738x family</a></li>
</ul>
</li>
<li><a class="reference internal" href="#oversampling-and-resolution-boost">Oversampling and resolution boost</a></li>
<li><a class="reference internal" href="#alert">Alert</a></li>
<li><a class="reference internal" href="#channel-selection-and-sequencer-single-end-chips-only">Channel selection and sequencer (single-end chips only)</a><ul>
<li><a class="reference internal" href="#gain-adaq-devices-only">Gain (ADAQ devices only)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unimplemented-features">Unimplemented features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spi-offload-support">SPI offload support</a></li>
<li><a class="reference internal" href="#device-buffers">Device buffers</a></li>
</ul>
</li>
</ul>

        </nav>
      </div>
    </div>

  
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
    <a id="no-logo" href="../index.html">
      Linux Drivers
    </a><input id="input-switch-toc" type="checkbox">
<label id="show-repotoc" for="input-switch-toc">
All content
</label>
<label id="show-toc" for="input-switch-toc">
Content on this topic
</label>
<div class="repotoc-tree">
  <root>
  <a href="../index.html" class="current">Linux</a>
</root>

</div>
<div class="toc-tree">
  <html>
  <body><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1" id="toctree-collapse-1" checked=""/><div class="collapse"><a class="reference internal" href="index.html">Industrial I/O</a><label for="toctree-collapse-1"><div class="icon"></div></label></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="iio_devbuf.html">Industrial IIO device buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad3552r.html">AD3552R driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad4000.html">AD4000 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad4695.html">AD4695 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad7191.html">AD7191 driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">AD7380 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad7625.html">AD7625 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ad7944.html">AD7944 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adis16475.html">ADIS16475 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adis16480.html">ADIS16480 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adis16550.html">ADIS16550 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="adxl380.html">ADXL380 driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="apollo.html">AD9088 driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci.html">Continuous integration</a></li>
</ul>
</body>
</html>

</div>
        </div>
      </div>

  <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper" id="top-anchor">
          <div class="body-header">
  <nav class="breadcrumb"><ol><li><a href="index.html">Industrial I/O</a></li></ol></nav>
</div>
          <div class="body" role="main">
            
  <section id="ad7380-driver">
<h1>AD7380 driver<a class="headerlink" href="#ad7380-driver" title="Link to this heading"></a></h1>
<p>ADC driver for Analog Devices Inc. AD7380 and similar devices. The module name
is <code class="docutils literal notranslate"><span class="pre">ad7380</span></code>.</p>
<section id="supported-devices">
<h2>Supported devices<a class="headerlink" href="#supported-devices" title="Link to this heading"></a></h2>
<p>The following chips are supported by this driver:</p>
<ul class="simple">
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7380.html" target="_blank">AD7380</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7381.html" target="_blank">AD7381</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7383.html" target="_blank">AD7383</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7384.html" target="_blank">AD7384</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7386.html" target="_blank">AD7386</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7387.html" target="_blank">AD7387</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7388.html" target="_blank">AD7388</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7380-4.html" target="_blank">AD7380-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7381-4.html" target="_blank">AD7381-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7383-4.html" target="_blank">AD7383-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7384-4.html" target="_blank">AD7384-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7386-4.html" target="_blank">AD7386-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7387-4.html" target="_blank">AD7387-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7388-4.html" target="_blank">AD7388-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/ad7389-4.html" target="_blank">AD7389-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/adaq4370-4.html" target="_blank">ADAQ4370-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/adaq4380-4.html" target="_blank">ADAQ4380-4</a></p></li>
<li><p><a class="icon link reference external" href="https://www.analog.com/en/products/adaq4381-4.html" target="_blank">ADAQ4381-4</a></p></li>
</ul>
</section>
<section id="supported-features">
<h2>Supported features<a class="headerlink" href="#supported-features" title="Link to this heading"></a></h2>
<section id="spi-wiring-modes">
<h3>SPI wiring modes<a class="headerlink" href="#spi-wiring-modes" title="Link to this heading"></a></h3>
<p>ad738x ADCs can output data on several SDO lines (1/2/4). The driver currently
supports only 1 SDO line.</p>
</section>
<section id="reference-voltage">
<h3>Reference voltage<a class="headerlink" href="#reference-voltage" title="Link to this heading"></a></h3>
<section id="id1">
<h4>ad7380-4<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>ad7380-4 supports only an external reference voltage (2.5V to 3.3V). It must be
declared in the device tree as <code class="docutils literal notranslate"><span class="pre">refin-supply</span></code>.</p>
</section>
<section id="id2">
<h4>ad7389-4<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>ad7389-4 supports only an internal reference voltage. <code class="docutils literal notranslate"><span class="pre">refin-supply</span></code> and
<code class="docutils literal notranslate"><span class="pre">refio-supply</span></code> properties are both omitted in this case.</p>
</section>
<section id="adaq-devices">
<h4>ADAQ devices<a class="headerlink" href="#adaq-devices" title="Link to this heading"></a></h4>
<p>ADAQ devices donâ€™t have an external reference, but use a 3.3V internal reference
derived from one of its supplies (<code class="docutils literal notranslate"><span class="pre">refin-supply</span></code>)</p>
</section>
<section id="all-other-devices-from-ad738x-family">
<h4>All other devices from ad738x family<a class="headerlink" href="#all-other-devices-from-ad738x-family" title="Link to this heading"></a></h4>
<p>All other devices from ad738x support 2 possible reference voltage sources:</p>
<ul class="simple">
<li><p>Internal reference (2.5V)</p></li>
<li><p>External reference (2.5V to 3.3V)</p></li>
</ul>
<p>The source is determined by the device tree. If <code class="docutils literal notranslate"><span class="pre">refio-supply</span></code> is present,
then it is used as external reference, else the internal reference is used.</p>
</section>
</section>
<section id="oversampling-and-resolution-boost">
<h3>Oversampling and resolution boost<a class="headerlink" href="#oversampling-and-resolution-boost" title="Link to this heading"></a></h3>
<p>This family supports 2 types of oversampling: normal average and rolling
average. Only normal average is supported by the driver, as rolling average can
be achieved by processing a captured data buffer. The following ratios are
available: 1 (oversampling disabled)/2/4/8/16/32.</p>
<p>When the on-chip oversampling function is enabled the performance of the ADC can
exceed the default resolution. To accommodate the performance boost achievable,
it is possible to enable an additional two bits of resolution. Because the
resolution boost feature can only be enabled when oversampling is enabled and
oversampling is not as useful without the resolution boost, the driver
automatically enables the resolution boost if and only if oversampling is
enabled.</p>
<p>Since the resolution boost feature causes 16-bit chips to now have 18-bit data
which means the storagebits has to change from 16 to 32 bits, we use the new
ext_scan_type feature to allow changing the scan_type at runtime. Unfortunately
libiio does not support it. So when enabling or disabling oversampling, user
must restart iiod using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root:~#<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>iiod
</pre></div>
</div>
</section>
<section id="alert">
<h3>Alert<a class="headerlink" href="#alert" title="Link to this heading"></a></h3>
<p>2 channels variants of the ad738x family, can use the SDOB line as an alert pin
when configured in 1 SDO line mode. 4 channels variants, can use SDOD as an
alert pin when configured in 1 or 2 SDO line(s) mode, although only 1 SDO line
mode is currently supported by the driver (see <a class="reference internal" href="#spi-wiring-modes">SPI wiring modes</a>).</p>
<p>At the end of a conversion the active-low alert pin gets asserted if the
conversion result exceeds the alert high limit or falls below the alert low
limit. It is cleared, on a falling edge of CS. The alert pin is common to all
channels.</p>
<p>User can enable alert using the regular iio events attribute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>events/thresh_either_en
</pre></div>
</div>
<p>The high and low thresholds are common to all channels and can also be set using
regular iio events attributes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>events/in_thresh_falling_value
events/in_thresh_rising_value
</pre></div>
</div>
<p>If debugfs is available, user can read the ALERT register to determine the
faulty channel and direction.</p>
<p>In most use cases, user will hardwire the alert pin to trigger a shutdown.</p>
</section>
<section id="channel-selection-and-sequencer-single-end-chips-only">
<h3>Channel selection and sequencer (single-end chips only)<a class="headerlink" href="#channel-selection-and-sequencer-single-end-chips-only" title="Link to this heading"></a></h3>
<p>Single-ended chips of this family (ad7386/7/8(-4)) have a 2:1 multiplexer in
front of each ADC. They also include additional configuration registers that
allow for either manual selection or automatic switching (sequencer mode), of
the multiplexer inputs.</p>
<p>From an IIO point of view, all inputs are exported, i.e ad7386/7/8
export 4 channels and ad7386-4/7-4/8-4 export 8 channels.</p>
<p>Inputs <code class="docutils literal notranslate"><span class="pre">AinX0</span></code> of multiplexers correspond to the first half of IIO channels (i.e
0-1 or 0-3) and inputs <code class="docutils literal notranslate"><span class="pre">AinX1</span></code> correspond to second half (i.e 2-3 or 4-7).
Example for AD7386/7/8 (2 channels parts):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">IIO</span>   <span class="o">|</span> <span class="n">AD7386</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="mi">8</span>
         <span class="o">|</span>         <span class="o">+----------------------------</span>
         <span class="o">|</span>         <span class="o">|</span>     <span class="n">_____</span>        <span class="n">______</span>
         <span class="o">|</span>         <span class="o">|</span>    <span class="o">|</span>     <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>
<span class="n">voltage0</span> <span class="o">|</span> <span class="n">AinA0</span> <span class="o">--|---&gt;|</span>     <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>
         <span class="o">|</span>         <span class="o">|</span>    <span class="o">|</span> <span class="n">mux</span> <span class="o">|-----&gt;|</span> <span class="n">ADCA</span> <span class="o">|---</span>
<span class="n">voltage2</span> <span class="o">|</span> <span class="n">AinA1</span> <span class="o">--|---&gt;|</span>     <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>
         <span class="o">|</span>         <span class="o">|</span>    <span class="o">|</span><span class="n">_____</span><span class="o">|</span>      <span class="o">|</span><span class="n">_____</span> <span class="o">|</span>
         <span class="o">|</span>         <span class="o">|</span>     <span class="n">_____</span>        <span class="n">______</span>
         <span class="o">|</span>         <span class="o">|</span>    <span class="o">|</span>     <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>
<span class="n">voltage1</span> <span class="o">|</span> <span class="n">AinB0</span> <span class="o">--|---&gt;|</span>     <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>
         <span class="o">|</span>         <span class="o">|</span>    <span class="o">|</span> <span class="n">mux</span> <span class="o">|-----&gt;|</span> <span class="n">ADCB</span> <span class="o">|---</span>
<span class="n">voltage3</span> <span class="o">|</span> <span class="n">AinB1</span> <span class="o">--|---&gt;|</span>     <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>
         <span class="o">|</span>         <span class="o">|</span>    <span class="o">|</span><span class="n">_____</span><span class="o">|</span>      <span class="o">|</span><span class="n">______</span><span class="o">|</span>
         <span class="o">|</span>         <span class="o">|</span>
         <span class="o">|</span>         <span class="o">+----------------------------</span>
</pre></div>
</div>
<p>When enabling sequencer mode, the effective sampling rate is divided by two.</p>
<section id="gain-adaq-devices-only">
<h4>Gain (ADAQ devices only)<a class="headerlink" href="#gain-adaq-devices-only" title="Link to this heading"></a></h4>
<p>ADAQ devices have a pin selectable gain in front of each ADC. The appropriate
gain is selectable from device tree using the <code class="docutils literal notranslate"><span class="pre">adi,gain-milli</span></code> property.
Refer to the typical connection diagrams section of the datasheet for pin
wiring.</p>
</section>
</section>
<section id="unimplemented-features">
<h3>Unimplemented features<a class="headerlink" href="#unimplemented-features" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>2/4 SDO lines</p></li>
<li><p>Rolling average oversampling</p></li>
<li><p>Power down mode</p></li>
<li><p>CRC indication</p></li>
</ul>
</section>
</section>
<section id="spi-offload-support">
<h2>SPI offload support<a class="headerlink" href="#spi-offload-support" title="Link to this heading"></a></h2>
<p>To be able to achieve the maximum sample rate, the driver can be used with the
<a class="icon link reference external" href="http://analogdevicesinc.github.io/hdl/projects/pulsar_adc/index.html" target="_blank">AXI SPI Engine</a> to provide SPI offload support.</p>
<p>When SPI offload is being used, some attributes will be different.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trigger</span></code> directory is removed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_voltage0_sampling_frequency</span></code> attribute is added for setting the sample
rate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_voltage0_sampling_frequency_available</span></code> attribute is added for querying
the max sample rate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code> channel is removed.</p></li>
<li><p>Buffer data format may be different compared to when offload is not used,
e.g. the <code class="docutils literal notranslate"><span class="pre">in_voltage0_type</span></code> attribute.</p></li>
</ul>
</section>
<section id="device-buffers">
<h2>Device buffers<a class="headerlink" href="#device-buffers" title="Link to this heading"></a></h2>
<p>This driver supports IIO triggered buffers.</p>
<p>See <a class="reference internal" href="iio_devbuf.html"><span class="doc">Industrial IIO device buffers</span></a> for more information.</p>
</section>
</section>


          </div>
              <div class="related">
                &nbsp;
    <a href="ad7191.html" title="Previous document (Alt+Shift+LeftArrow)" class="prev">AD7191 driver</a>
    <a href="ad7625.html" title="Next document (Alt+Shift+RightArrow)" class="next">AD7625 driver</a>
              </div>
          
        </div>
      </div>
  </div>

  <label id="cancel-area-show-toc" for="input-show-toc"></label>
  <label id="cancel-area-show-localtoc" for="input-show-localtoc"></label>
    <footer>
      &#169;2025, Analog Devices, Inc.
      
      |
      Made with <a href="https://www.sphinx-doc.org/">Sphinx</a>
      &amp; <a href="https://github.com/analogdevicesinc/doctools">Doctools</a>
      
    </footer>
  </body>
</html>